
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://insper.github.io/supercomp/aulas/10-thrust/">
      
      
        <link rel="prev" href="../09-heuristica/">
      
      
        <link rel="next" href="../../projetos/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Aula 10 - Thrust para programação paralela em GPU - SuperComputação - 2024/2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/printing.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../equipe.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aula-10-thrust-para-programacao-paralela-em-gpu" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SuperComputação - 2024/2" class="md-header__button md-logo" aria-label="SuperComputação - 2024/2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SuperComputação - 2024/2
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Aula 10 - Thrust para programação paralela em GPU
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/insper/supercomp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SuperComp
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SuperComputação - 2024/2" class="md-nav__button md-logo" aria-label="SuperComputação - 2024/2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SuperComputação - 2024/2
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/insper/supercomp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SuperComp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Aulas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Aulas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entregas e Objetivos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-introducao/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 0: A importância da linguagem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introducao/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 1: Acessando o Cluster Franky
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-slurm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 02: Explorando Comandos SLURM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-cpp/aula-4.pdf" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 03 Introdução ao C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-cpp/03-cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 04: Usando o poder do C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-Profiling/04-Profiling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 05: Otimização e Profiling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-heuristicas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 06: Problema da Mochila com Busca Exaustiva
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-aleatorizacao/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 07: Problema da Mochila com Heurística Aleatória
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-busca-local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 08: Problema da Mochila com Busca Local e Hill Climb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-heuristica/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aula 09: Problema da Mochila com Heurísticas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Aula 10 - Thrust para programação paralela em GPU
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Aula 10 - Thrust para programação paralela em GPU
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#o-que-e-thrust" class="md-nav__link">
    <span class="md-ellipsis">
      O que é Thrust?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#como-thrust-funciona" class="md-nav__link">
    <span class="md-ellipsis">
      Como Thrust Funciona?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vantagens-de-usar-thrust" class="md-nav__link">
    <span class="md-ellipsis">
      Vantagens de Usar Thrust
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usando-o-google-colab" class="md-nav__link">
    <span class="md-ellipsis">
      Usando o Google Colab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilacao-com-nvcc" class="md-nav__link">
    <span class="md-ellipsis">
      Compilação com NVCC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformacoes-e-operacoes-matematicas-com-vetores-na-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      Transformações e Operações Matemáticas com Vetores na GPU
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leitura-de-arquivos-pela-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      Leitura de arquivos pela GPU
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operacoes-de-reducao-e-transformacoes" class="md-nav__link">
    <span class="md-ellipsis">
      Operações de Redução e Transformações
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#atividade-10" class="md-nav__link">
    <span class="md-ellipsis">
      Atividade 10
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Projeto
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Projeto
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../projetos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projeto da disciplina
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Teoria
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Teoria
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Materiais e Guias para estudo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/contextualizando-hpc/contextualizando-HPC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contextualizando o HPC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/cluster-Franky/cluster-Franky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Franky
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/slurm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SLURM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/comandos-ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transferência de Arquivos entre sua máquina e o Cluster Franky
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/introducao/conceitos-basicos-hw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relembrando conceitos importantes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/conceitos-basicos-C%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conceitos básicos de C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/compilar-executar-C%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compilar/Executar Códigos C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/loops-e-la%C3%A7os/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loops e Laços
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/funcoes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Passagem de Parâmetros
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/uso-de-constantes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Const Correctness em HPC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/memoria-dinamica/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alocação de Memória Dinâmica
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/sobrecarga-de-funcoes-C%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sobrecarga de Funções em C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/classes-e-objetos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Classes e objetos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/manipulacao-vetores/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manipulação de Vetores
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/flags-compilacao/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flags de compilação (-O1, -O2, -O3, -Ofast).
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Teoria/profiling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profiling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#o-que-e-thrust" class="md-nav__link">
    <span class="md-ellipsis">
      O que é Thrust?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#como-thrust-funciona" class="md-nav__link">
    <span class="md-ellipsis">
      Como Thrust Funciona?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vantagens-de-usar-thrust" class="md-nav__link">
    <span class="md-ellipsis">
      Vantagens de Usar Thrust
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usando-o-google-colab" class="md-nav__link">
    <span class="md-ellipsis">
      Usando o Google Colab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilacao-com-nvcc" class="md-nav__link">
    <span class="md-ellipsis">
      Compilação com NVCC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformacoes-e-operacoes-matematicas-com-vetores-na-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      Transformações e Operações Matemáticas com Vetores na GPU
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leitura-de-arquivos-pela-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      Leitura de arquivos pela GPU
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operacoes-de-reducao-e-transformacoes" class="md-nav__link">
    <span class="md-ellipsis">
      Operações de Redução e Transformações
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#atividade-10" class="md-nav__link">
    <span class="md-ellipsis">
      Atividade 10
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="aula-10-thrust-para-programacao-paralela-em-gpu">Aula 10 - Thrust para programação paralela em GPU<a class="headerlink" href="#aula-10-thrust-para-programacao-paralela-em-gpu" title="Permanent link">&para;</a></h1>
<h3 id="o-que-e-thrust">O que é Thrust?<a class="headerlink" href="#o-que-e-thrust" title="Permanent link">&para;</a></h3>
<p>Thrust é uma biblioteca desenvolvida pela Nvidia para facilitar a programação em GPUs. Ela é inspirada na <a href="https://www.geeksforgeeks.org/the-c-standard-template-library-stl/">biblioteca da STL (Standard Template Library)</a> do C++, mas com um foco em operações paralelas, tanto na GPU quanto na CPU. Thrust permite que o codigo seja executado de forma eficiente em paralelo, sem a complexidade de escrever kernels CUDA.</p>
<h3 id="como-thrust-funciona">Como Thrust Funciona?<a class="headerlink" href="#como-thrust-funciona" title="Permanent link">&para;</a></h3>
<p>Thrust fornece uma série de algoritmos e estruturas de dados otimizadas para execução em paralelo. Isso inclui:</p>
<ul>
<li><strong>Vetores</strong>: <code>thrust::host_vector</code> e <code>thrust::device_vector</code> são vetores que gerenciam memória na CPU e GPU, respectivamente.</li>
<li><strong>Algoritmos</strong>: Thrust oferece uma variedade de algoritmos paralelos prontos para uso, como <code>thrust::sort</code>, <code>thrust::reduce</code>, <code>thrust::transform</code>, entre outros.</li>
<li><strong>Iteradores</strong>: Assim como a STL, Thrust usa iteradores para percorrer elementos de vetores, permitindo aplicar algoritmos de maneira eficiente.</li>
</ul>
<p>Por exemplo, em vez de escrever um kernel CUDA manualmente para somar os elementos de um vetor, você pode usar a função <code>thrust::reduce</code>, que faz isso de forma otimizada e em paralelo na GPU.</p>
<h3 id="vantagens-de-usar-thrust">Vantagens de Usar Thrust<a class="headerlink" href="#vantagens-de-usar-thrust" title="Permanent link">&para;</a></h3>
<p><strong>1. Simplicidade:</strong>
Thrust abstrai a complexidade da programação paralela em CUDA. </p>
<p><strong>2. Portabilidade:</strong>
Um dos grandes benefícios da Thrust é que o mesmo código pode ser compilado para rodar tanto na CPU quanto na GPU. Isso é possível porque Thrust permite escolher o backend de execução: você pode usar <a href="http://homepages.math.uic.edu/~jan/mcs572f16/mcs572notes/lec09.html">OpenMP</a>, <a href="https://oneapi-src.github.io/oneTBB/">TBB (Threading Building Blocks)</a> ou a própria GPU. Isso torna seu código mais flexível e portátil.</p>
<p><strong>3. Desempenho:</strong>
Thrust é otimizada para aproveitar ao máximo a capacidade de processamento paralelo das GPUs da Nvidia. Como muitos dos algoritmos oferecidos pela Thrust são implementados diretamente em CUDA, eles podem ser significativamente mais rápidos que implementações sequenciais tradicionais, especialmente em operações que envolvem grandes volumes de dados.</p>
<p><strong>4. Reuso de Código:</strong>
Assim como a STL, Thrust permite reutilizar muito código. Como ela é baseada em templates, você pode aplicar os mesmos algoritmos em diferentes tipos de dados e vetores, sem precisar reescrever a lógica para cada caso.</p>
<h3 id="usando-o-google-colab"><strong>Usando o Google Colab</strong><a class="headerlink" href="#usando-o-google-colab" title="Permanent link">&para;</a></h3>
<p>Primeiro, acesse o <a href="https://colab.research.google.com/">Google Colab</a>, crie um novo notebook. No Colab, podemos escolher o tipo de hardware que o nosso código vai usar. Para isso, vá no menu "Runtime" e clique em "change runtime type". Na seção “Hardware accelerator”, selecione "T4 GPU". Para que possamos executar o nosso código diretamente na GPU.</p>
<p>Para verificar se a GPU está ativa, rode o seguinte comando na célula do Colab:</p>
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</code></pre></div>
<p>Este comando vai mostrar informações sobre a GPU que estamos usando, como o modelo e o uso de memória. Se tudo estiver certo, você verá a GPU listada, o que confirma que o ambiente está pronto.</p>
<h3 id="compilacao-com-nvcc"><strong>Compilação com NVCC</strong><a class="headerlink" href="#compilacao-com-nvcc" title="Permanent link">&para;</a></h3>
<p>Agora que o Colab está configurado, precisamos entender como compilar nosso código para rodar na GPU. O compilador que usamos para isso é o <code>nvcc</code>, que faz parte do pacote de ferramentas da Nvidia do CUDA Toolkit.</p>
<p>O <code>nvcc</code> é um compilador que identifica quais partes do código devem rodar na GPU e quais partes ficam na CPU. A grande vantagem dele é que, no final, tudo é combinado em um único executável que gerencia automaticamente quando a GPU ou CPU devem ser usadas.</p>
<p>Vamos compilar um exemplo simples para testar o <code>nvcc</code>. Carreque o arquivo <a href="files/exemplo1-criacao-iteracao.cu">exemplo1.cu</a> no colab, compile e crie um executável, usando o comando:</p>
<div class="highlight"><pre><span></span><code>!nvcc<span class="w"> </span>-arch<span class="o">=</span>sm_75<span class="w"> </span>-std<span class="o">=</span>c++14<span class="w"> </span>exemplo1.cu<span class="w"> </span>-o<span class="w"> </span>exemplo1
</code></pre></div>
<p>Se tudo funcionar corretamente, este comando vai gerar um executável chamado <code>exemplo1</code>, que podemos rodar para ver os resultados.</p>
<div class="highlight"><pre><span></span><code>!./exemplo1
</code></pre></div>
<h3 id="transformacoes-e-operacoes-matematicas-com-vetores-na-gpu">Transformações e Operações Matemáticas com Vetores na GPU<a class="headerlink" href="#transformacoes-e-operacoes-matematicas-com-vetores-na-gpu" title="Permanent link">&para;</a></h3>
<p>Uma das grandes vantagens de Thrust é a capacidade de aplicar transformações e operações ponto a ponto de forma eficiente, diretamente na GPU. Isso é extremamente útil para manipulações de vetores, onde queremos aplicar operações como soma, multiplicação, etc, de forma paralela.</p>
<p>Com Thrust, podemos facilmente realizar essas transformações entre vetores, utilizando funções como <code>thrust::transform</code>, que permite aplicar uma operação matemática entre os elementos de dois vetores ou transformar um vetor usando um valor constante. </p>
<p>Neste exemplo, vamos criar dois vetores na GPU e aplicar transformações entre eles, demonstrando como podemos somar os elementos de um vetor com outro e preencher vetores com valores específicos. Essas operações são realizadas de maneira otimizada na GPU, aproveitando o paralelismo do hardware para acelerar o processamento.</p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">writefile</span><span class="w"> </span><span class="n">exemplo2</span><span class="p">.</span><span class="n">cu</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/device_vector.h&gt;</span><span class="c1">              // Inclui a biblioteca para vetores na GPU</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/host_vector.h&gt;</span><span class="c1">                // Inclui a biblioteca para vetores na CPU</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/sequence.h&gt;</span><span class="c1">                   // Inclui a função para preencher vetores com uma sequência de números</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/functional.h&gt;</span><span class="c1">                 // Inclui operações matemáticas padrão, como soma e multiplicação</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/transform.h&gt;</span><span class="c1">                  // Inclui a função para transformar vetores com operações ponto a ponto</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/iterator/constant_iterator.h&gt;</span><span class="c1"> // Inclui o iterador constante necessário</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="c1">   </span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Cria um vetor na GPU (device_vector) com 10 elementos, todos inicializados com 0</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">V1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Preenche V1 com uma sequência de números: {0, 1, 2, ..., 9}</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">sequence</span><span class="p">(</span><span class="n">V1</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">V1</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Cria um vetor na GPU com 5 elementos, todos inicializados com 0</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">V2</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Preenche os dois primeiros elementos de V2 com 5.5: {5.5, 5.5, 0, 0, 0}</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">fill</span><span class="p">(</span><span class="n">V2</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">V2</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mf">5.5</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Preenche os elementos restantes de V2 com 10: {5.5, 5.5, 10, 10, 10}</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">fill</span><span class="p">(</span><span class="n">V2</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">V2</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Cria dois vetores na GPU com 10 elementos, para armazenar resultados das operações</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">V3</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// Vetor para armazenar o resultado da soma</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">V4</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// Vetor para armazenar o resultado da multiplicação</span>

<span class="w">    </span><span class="c1">// Aplica a operação de soma elemento por elemento entre V1 e V2 e armazena o resultado em V3</span>
<span class="w">    </span><span class="c1">// Como V2 tem menos elementos, o restante de V1 é somado com zeros (elemento padrão).</span>
<span class="w">    </span><span class="c1">// Resultado: V3 = {0+5.5, 1+5.5, 2+10, 3+10, 4+10, 5+0, ..., 9+0}</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">transform</span><span class="p">(</span><span class="n">V1</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">V1</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">V2</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">V3</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">thrust</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Aplica multiplicação de V1 com o valor constante 0.5</span>
<span class="w">    </span><span class="c1">// e armazenaria o resultado em V4.</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">transform</span><span class="p">(</span><span class="n">V1</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">V1</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">thrust</span><span class="o">::</span><span class="n">constant_iterator</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">V4</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">thrust</span><span class="o">::</span><span class="n">multiplies</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Imprime os elementos de V1</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;V1: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V1</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">V1</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Acessa e imprime cada elemento do vetor V1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Imprime os elementos de V2</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;V2: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V2</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">V2</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Acessa e imprime cada elemento do vetor V2</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Imprime os elementos de V3</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;V3: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V3</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">V3</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Acessa e imprime cada elemento do vetor V3</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Imprime o vetor V4, que foi criado mas não utilizado.</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;V4: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V4</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">V4</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Para compilar o exemplo2 no colab</p>
<div class="highlight"><pre><span></span><code>!nvcc -arch=sm_75 -std=c++14 exemplo2.cu -o exemplo2
</code></pre></div>
<p>Para executar o binário</p>
<div class="highlight"><pre><span></span><code>!./exemplo2
</code></pre></div>
<h3 id="leitura-de-arquivos-pela-gpu">Leitura de arquivos pela GPU<a class="headerlink" href="#leitura-de-arquivos-pela-gpu" title="Permanent link">&para;</a></h3>
<p>Neste exemplo,o código faz a leitura de uma série de valores numéricos que representam, por exemplo, os preços históricos de ações. Esses valores são inicialmente armazenados em um vetor na memória da CPU, chamado <code>host_vector</code>. Em seguida, esses dados são copiados para a GPU usando um <code>device_vector</code>.</p>
<p>O objetivo do código é medir dois tempos: o tempo de leitura dos dados na CPU e o tempo de cópia dos dados para a GPU. Avaliar esses tempos ajuda a identificar como a comunicação entre a CPU e a GPU pode afetar o desempenho geral do seu programa. </p>
<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">writefile</span><span class="w"> </span><span class="n">stocks</span><span class="p">.</span><span class="n">cu</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/device_vector.h&gt;</span><span class="c1">   // Inclui a biblioteca Thrust para vetores na GPU</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/host_vector.h&gt;</span><span class="c1">     // Inclui a biblioteca Thrust para vetores na CPU</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="c1">                 // Biblioteca padrão para entrada e saída de dados</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span><span class="c1">                   // Biblioteca para medir o tempo de execução do código</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2518</span><span class="p">;</span><span class="w">                   </span><span class="c1">// Define o tamanho do vetor (2518 elementos)</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w">             </span><span class="c1">// Variável auxiliar para armazenar o valor lido da entrada</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">diff</span><span class="p">;</span><span class="w"> </span><span class="c1">// Variável para armazenar a diferença de tempo calculada</span>

<span class="w">    </span><span class="c1">// Marca o início da medição do tempo de leitura dos dados</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">leitura_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Cria um vetor na CPU (host_vector) com n elementos, todos inicializados com 0</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">host_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">host</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Loop para ler n valores da entrada padrão e armazená-los no vetor host</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">              </span><span class="c1">// Lê um valor da entrada padrão</span>
<span class="w">        </span><span class="n">host</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">           </span><span class="c1">// Armazena o valor lido no vetor host</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Marca o fim da medição do tempo de leitura dos dados</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">leitura_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Calcula o tempo gasto na leitura dos dados</span>
<span class="w">    </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leitura_f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">leitura_i</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Exibe o tempo de leitura em segundos</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Tempo de LEITURA (em segundos)  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">diff</span><span class="p">.</span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Marca o início da medição do tempo de cópia dos dados da CPU para a GPU</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">copia_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Cria um vetor na GPU (device_vector) copiando os dados do vetor host da CPU</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dev</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Marca o fim da medição do tempo de cópia dos dados</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">copia_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Calcula o tempo gasto na cópia dos dados para a GPU</span>
<span class="w">    </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copia_f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">copia_i</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Exibe o tempo de cópia em segundos</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Tempo de CÓPIA (em segundos)  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">diff</span><span class="p">.</span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Para compilar o código:</p>
<p><div class="highlight"><pre><span></span><code>!nvcc -arch=sm_70 -std=c++14 stocks.cu -o stocks
</code></pre></div>
Faça upload <a href="files/stocks-google.txt">deste arquivo</a> no seu colab para executar o exemplo</p>
<div class="highlight"><pre><span></span><code>!./stocks &lt; stocks-google.txt
</code></pre></div>
<h3 id="operacoes-de-reducao-e-transformacoes"><strong>Operações de Redução e Transformações</strong><a class="headerlink" href="#operacoes-de-reducao-e-transformacoes" title="Permanent link">&para;</a></h3>
<p>Além de gerenciar a transferência de dados, a Thrust também facilita operações complexas como reduções (soma, máximo, mínimo) e transformações entre vetores. Esses tipos de operações são muito úteis em cálculos intensivos, como análise de séries temporais de preços de ações.</p>
<p><strong>Reduções com Thrust:</strong></p>
<p>Reduções são operações que reduzem um vetor a um único valor. Por exemplo, podemos calcular a soma, o máximo ou a média dos elementos de um vetor. A função <code>thrust::reduce</code> é usada para esse tipo de operação.</p>
<p>Um exemplo para calcular a soma dos elementos de um vetor:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/device_vector.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/reduce.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Criando um vetor na GPU com 5 elementos: {10, 20, 30, 40, 50}</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vec_gpu</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">sequence</span><span class="p">(</span><span class="n">vec_gpu</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">vec_gpu</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Calculando a soma dos elementos</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">soma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thrust</span><span class="o">::</span><span class="n">reduce</span><span class="p">(</span><span class="n">vec_gpu</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">vec_gpu</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">thrust</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Soma dos elementos: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">soma</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Saída: 150</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Aqui, usamos <code>thrust::sequence</code> para preencher o vetor e <code>thrust::reduce</code> para somar todos os elementos. O valor <code>0</code> é o valor inicial da soma e <code>thrust::plus&lt;int&gt;</code> é a operação de adição.</p>
<p><strong>Transformações entre Vetores:</strong></p>
<p>Além das reduções, podemos realizar transformações entre vetores, que envolvem modificar um vetor com base em operações ponto a ponto, ou até mesmo combinar dois vetores em um.</p>
<p>Por exemplo, vamos calcular a diferença ponto a ponto entre os preços das ações da Apple e da Microsoft usando <code>thrust::transform</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/device_vector.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thrust/transform.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Criando vetores de preços na GPU</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AAPL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mf">150.0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Exemplo com preço fixo</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MSFT</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mf">140.0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Exemplo com preço fixo</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">diff</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">         </span><span class="c1">// Para armazenar as diferenças</span>

<span class="w">    </span><span class="c1">// Calculando a diferença ponto a ponto entre os preços</span>
<span class="w">    </span><span class="n">thrust</span><span class="o">::</span><span class="n">transform</span><span class="p">(</span><span class="n">AAPL</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">AAPL</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">MSFT</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">diff</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">thrust</span><span class="o">::</span><span class="n">minus</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Exibindo as diferenças</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">diff</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Diferença &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Neste exemplo, <code>thrust::minus&lt;double&gt;</code> é a operação usada para calcular a diferença entre os elementos correspondentes dos dois vetores.</p>
<p>Para entender mais sobre as funcionalidades da Thrust, verifique a documentação oficial disponível no <a href="https://thrust.github.io/doc/modules.html">site da Thrust</a>. </p>
<h3 id="atividade-10">Atividade 10<a class="headerlink" href="#atividade-10" title="Permanent link">&para;</a></h3>
<p>Vamos trabalhar com um arquivo que contém os preços das ações do Google nos últimos 10 anos, <a href="files/stocks-google.txt">stocks-google.txt</a>. A ideia é ler esses dados com um <code>thrust::host_vector</code>, transferir para a GPU e, em seguida, processá-los. </p>
<p><strong>Exercício 1: Leitura e Transferência de Dados</strong></p>
<ol>
<li>Leiam os preços das ações de <a href="files/stocks-google.txt">stocks-google.txt</a> e armazenem em um <code>host_vector</code>.</li>
<li>Criem um <code>device_vector</code> e transfiram os dados do <code>host_vector</code> para ele.</li>
<li>Meçam o tempo de alocação e cópia dos dados usando a biblioteca <code>std::chrono</code> e imprimam esse tempo para ver quanto tempo a operação leva.</li>
</ol>
<p><strong>Exercício 2: Cálculo de Médias e Extremos</strong></p>
<p>Agora que os dados estão na GPU, vamos realizar algumas operações de redução. As operações de redução são aquelas que transformam um vetor em um único valor, como calcular a soma ou o máximo dos elementos.</p>
<ol>
<li>Calculem o preço médio das ações do Google nos últimos 10 anos.</li>
<li>Calculem o preço médio das ações nos últimos 365 dias.</li>
<li>Encontrem o maior e o menor preço do período total e do último ano.</li>
</ol>
<p><strong>Exercício 3: Transformações entre Vetores</strong></p>
<p>Vamos trabalhar com outro arquivo, <a href="files/stocks2.txt">stocks2.txt</a>, que contém os preços das ações da Apple e Microsoft. O objetivo é calcular a diferença média entre os preços das ações das duas empresas.</p>
<ol>
<li>Leiam os preços das ações de ambas as empresas e armazenem em dois <code>device_vectors</code>.</li>
<li>Calculem a diferença ponto a ponto entre os dois vetores e armazenem as diferenças em um terceiro vetor.</li>
<li>Calculem a média das diferenças para entender qual empresa teve, em média, um preço maior.</li>
</ol>
<p><strong>Submeta o link do seu repositório no BlackBoard até 17/09 as 23h59</strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.0.0/js-yaml.min.js"></script>
      
        <script src="../../js/markdown-enhancer.js"></script>
      
        <script src="../../js/slides.js"></script>
      
    
  </body>
</html>